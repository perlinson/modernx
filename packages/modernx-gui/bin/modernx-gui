#!/usr/bin/env node

const { startServer } = require('../src/lib/server');
const { detectProject } = require('../src/lib/project-detector');
const { openBrowser } = require('../src/lib/browser');

// Parse command line arguments
const args = process.argv.slice(2);
let port = 3000;

for (let i = 0; i < args.length; i++) {
  if (args[i] === '--port' && i + 1 < args.length) {
    port = parseInt(args[i + 1], 10);
    i++;
  } else if (args[i].startsWith('--port=')) {
    port = parseInt(args[i].replace('--port=', ''), 10);
  }
}

async function main() {
  try {
    console.log('ðŸš€ Starting ModernX GUI...');
    
    // Detect current project structure
    const projectInfo = await detectProject(process.cwd());
    console.log('ðŸ“ Project detected:', projectInfo.name);
    
    // Start development server
    const server = await startServer({
      port: port,
      projectInfo,
    });
    
    console.log(`ðŸŒ GUI Server running at: ${server.url}`);
    
    // Open browser automatically
    await openBrowser(server.url);
    console.log('âœ… ModernX GUI is ready!');
    
  } catch (error) {
    console.error('âŒ Failed to start ModernX GUI:', error.message);
    process.exit(1);
  }
}

main();
