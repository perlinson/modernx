<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>modernx-immer | ModernX</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Modern React state management framework with concurrent features">
    
    <link rel="preload" href="/modernx/assets/css/0.styles.7b828826.css" as="style"><link rel="preload" href="/modernx/assets/js/app.470600dd.js" as="script"><link rel="preload" href="/modernx/assets/js/2.3d5021cd.js" as="script"><link rel="preload" href="/modernx/assets/js/1.f4cd91dc.js" as="script"><link rel="preload" href="/modernx/assets/js/39.64a03e66.js" as="script"><link rel="prefetch" href="/modernx/assets/js/10.a5603e21.js"><link rel="prefetch" href="/modernx/assets/js/11.1e3b401f.js"><link rel="prefetch" href="/modernx/assets/js/12.00d462b1.js"><link rel="prefetch" href="/modernx/assets/js/13.1dc05648.js"><link rel="prefetch" href="/modernx/assets/js/14.da9197ce.js"><link rel="prefetch" href="/modernx/assets/js/15.ef624351.js"><link rel="prefetch" href="/modernx/assets/js/16.6ebb19a3.js"><link rel="prefetch" href="/modernx/assets/js/17.ec17d98a.js"><link rel="prefetch" href="/modernx/assets/js/18.179ed69d.js"><link rel="prefetch" href="/modernx/assets/js/19.599ad32f.js"><link rel="prefetch" href="/modernx/assets/js/20.bdc16c97.js"><link rel="prefetch" href="/modernx/assets/js/21.3ff21a0e.js"><link rel="prefetch" href="/modernx/assets/js/22.704096b7.js"><link rel="prefetch" href="/modernx/assets/js/23.e99aba69.js"><link rel="prefetch" href="/modernx/assets/js/24.f25e74ef.js"><link rel="prefetch" href="/modernx/assets/js/25.53d1d99e.js"><link rel="prefetch" href="/modernx/assets/js/26.c7cd93a8.js"><link rel="prefetch" href="/modernx/assets/js/27.f8fabe5d.js"><link rel="prefetch" href="/modernx/assets/js/28.2ef3eda1.js"><link rel="prefetch" href="/modernx/assets/js/29.384e110c.js"><link rel="prefetch" href="/modernx/assets/js/3.adc08618.js"><link rel="prefetch" href="/modernx/assets/js/30.c947364d.js"><link rel="prefetch" href="/modernx/assets/js/31.e7b2a8b6.js"><link rel="prefetch" href="/modernx/assets/js/32.777261c0.js"><link rel="prefetch" href="/modernx/assets/js/33.a5412037.js"><link rel="prefetch" href="/modernx/assets/js/34.bacc9e82.js"><link rel="prefetch" href="/modernx/assets/js/35.ae284f2a.js"><link rel="prefetch" href="/modernx/assets/js/36.81e1fc20.js"><link rel="prefetch" href="/modernx/assets/js/37.56aa8132.js"><link rel="prefetch" href="/modernx/assets/js/38.9556c5b8.js"><link rel="prefetch" href="/modernx/assets/js/4.d112ee6e.js"><link rel="prefetch" href="/modernx/assets/js/40.7d9ed69a.js"><link rel="prefetch" href="/modernx/assets/js/41.f510c711.js"><link rel="prefetch" href="/modernx/assets/js/42.9f980c88.js"><link rel="prefetch" href="/modernx/assets/js/5.7141bfbf.js"><link rel="prefetch" href="/modernx/assets/js/6.00e7cf51.js"><link rel="prefetch" href="/modernx/assets/js/7.2210c270.js"><link rel="prefetch" href="/modernx/assets/js/vendors~docsearch.0644ee0a.js">
    <link rel="stylesheet" href="/modernx/assets/css/0.styles.7b828826.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/modernx/" class="home-link router-link-active"><!----> <span class="site-name">ModernX</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/modernx/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/modernx/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/modernx/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/modernx/packages/" class="nav-link router-link-active">
  Packages
</a></div><div class="nav-item"><a href="/modernx/examples/" class="nav-link">
  Examples
</a></div><div class="nav-item"><a href="/modernx/migration/" class="nav-link">
  Migration
</a></div><div class="nav-item"><a href="https://github.com/perlinson/modernx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/modernx/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/modernx/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/modernx/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/modernx/packages/" class="nav-link router-link-active">
  Packages
</a></div><div class="nav-item"><a href="/modernx/examples/" class="nav-link">
  Examples
</a></div><div class="nav-item"><a href="/modernx/migration/" class="nav-link">
  Migration
</a></div><div class="nav-item"><a href="https://github.com/perlinson/modernx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Core Packages</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/modernx/packages/modernx.html" class="sidebar-link">modernx</a></li><li><a href="/modernx/packages/modernx-core.html" class="sidebar-link">modernx-core</a></li><li><a href="/modernx/packages/modernx-cli.html" class="sidebar-link">modernx-cli</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Development Tools</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/modernx/packages/modernx-gui.html" class="sidebar-link">modernx-gui</a></li><li><a href="/modernx/packages/modernx-logger.html" class="sidebar-link">modernx-logger</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Plugins</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/modernx/packages/modernx-immer.html" aria-current="page" class="active sidebar-link">modernx-immer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ğŸ¯-ç‰¹æ€§" class="sidebar-link">ğŸ¯ ç‰¹æ€§</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ğŸš€-å¿«é€Ÿå¼€å§‹" class="sidebar-link">ğŸš€ å¿«é€Ÿå¼€å§‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#å®‰è£…" class="sidebar-link">å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#åŸºç¡€ä½¿ç”¨" class="sidebar-link">åŸºç¡€ä½¿ç”¨</a></li></ul></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ğŸ“‹-api-å‚è€ƒ" class="sidebar-link">ğŸ“‹ API å‚è€ƒ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#immer-æ’ä»¶" class="sidebar-link">immer æ’ä»¶</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#åœ¨-reducers-ä¸­ä½¿ç”¨" class="sidebar-link">åœ¨ Reducers ä¸­ä½¿ç”¨</a></li></ul></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ğŸ”§-é«˜çº§ç”¨æ³•" class="sidebar-link">ğŸ”§ é«˜çº§ç”¨æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#åµŒå¥—çŠ¶æ€æ›´æ–°" class="sidebar-link">åµŒå¥—çŠ¶æ€æ›´æ–°</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#æ¡ä»¶æ›´æ–°" class="sidebar-link">æ¡ä»¶æ›´æ–°</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#æ‰¹é‡æ›´æ–°" class="sidebar-link">æ‰¹é‡æ›´æ–°</a></li></ul></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ğŸ¯-ä½¿ç”¨åœºæ™¯" class="sidebar-link">ğŸ¯ ä½¿ç”¨åœºæ™¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#_1-å¤æ‚çŠ¶æ€ç»“æ„" class="sidebar-link">1. å¤æ‚çŠ¶æ€ç»“æ„</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#_2-æ•°ç»„å’Œå¯¹è±¡æ“ä½œ" class="sidebar-link">2. æ•°ç»„å’Œå¯¹è±¡æ“ä½œ</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#_3-æ€§èƒ½ä¼˜åŒ–" class="sidebar-link">3. æ€§èƒ½ä¼˜åŒ–</a></li></ul></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ğŸ”Œ-ä¸å…¶ä»–æ’ä»¶é›†æˆ" class="sidebar-link">ğŸ”Œ ä¸å…¶ä»–æ’ä»¶é›†æˆ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ä¸-logger-é›†æˆ" class="sidebar-link">ä¸ Logger é›†æˆ</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ä¸-loading-é›†æˆ" class="sidebar-link">ä¸ Loading é›†æˆ</a></li></ul></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ğŸ¨-æœ€ä½³å®è·µ" class="sidebar-link">ğŸ¨ æœ€ä½³å®è·µ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#_1-ä¿æŒ-reducers-çº¯å‡€" class="sidebar-link">1. ä¿æŒ reducers çº¯å‡€</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#_2-ä½¿ç”¨æè¿°æ€§çš„-action-åç§°" class="sidebar-link">2. ä½¿ç”¨æè¿°æ€§çš„ action åç§°</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#_3-åˆç†ç»„ç»‡çŠ¶æ€ç»“æ„" class="sidebar-link">3. åˆç†ç»„ç»‡çŠ¶æ€ç»“æ„</a></li></ul></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ğŸ§ª-æµ‹è¯•" class="sidebar-link">ğŸ§ª æµ‹è¯•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#æµ‹è¯•-immer-reducers" class="sidebar-link">æµ‹è¯• Immer Reducers</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#æµ‹è¯•å¤æ‚çŠ¶æ€æ“ä½œ" class="sidebar-link">æµ‹è¯•å¤æ‚çŠ¶æ€æ“ä½œ</a></li></ul></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ğŸš€-ç‰ˆæœ¬å†å²" class="sidebar-link">ğŸš€ ç‰ˆæœ¬å†å²</a></li><li class="sidebar-sub-header"><a href="/modernx/packages/modernx-immer.html#ğŸ“-æ”¯æŒ" class="sidebar-link">ğŸ“ æ”¯æŒ</a></li></ul></li><li><a href="/modernx/packages/modernx-loading.html" class="sidebar-link">modernx-loading</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="modernx-immer"><a href="#modernx-immer" class="header-anchor">#</a> modernx-immer</h1> <p>ModernX çš„ Immer é›†æˆæ’ä»¶ï¼Œæä¾›ä¸å¯å˜çŠ¶æ€æ›´æ–°çš„ä¾¿æ·æ–¹å¼ã€‚</p> <h2 id="ğŸ¯-ç‰¹æ€§"><a href="#ğŸ¯-ç‰¹æ€§" class="header-anchor">#</a> ğŸ¯ ç‰¹æ€§</h2> <ul><li>ğŸ”„ <strong>ä¸å¯å˜æ›´æ–°</strong> - ä½¿ç”¨ Immer ç®€åŒ–ä¸å¯å˜çŠ¶æ€æ›´æ–°</li> <li>âš¡ <strong>æ€§èƒ½ä¼˜åŒ–</strong> - è‡ªåŠ¨æ£€æµ‹çŠ¶æ€å˜åŒ–ï¼Œé¿å…ä¸å¿…è¦çš„æ›´æ–°</li> <li>ğŸ“ <strong>ç®€æ´è¯­æ³•</strong> - ä½¿ç”¨å¯å˜è¯­æ³•ç¼–å†™ä¸å¯å˜ä»£ç </li> <li>ğŸ”§ <strong>TypeScript</strong> - å®Œæ•´çš„ç±»å‹æ”¯æŒ</li> <li>ğŸ¯ <strong>é›¶é…ç½®</strong> - å¼€ç®±å³ç”¨</li></ul> <h2 id="ğŸš€-å¿«é€Ÿå¼€å§‹"><a href="#ğŸš€-å¿«é€Ÿå¼€å§‹" class="header-anchor">#</a> ğŸš€ å¿«é€Ÿå¼€å§‹</h2> <h3 id="å®‰è£…"><a href="#å®‰è£…" class="header-anchor">#</a> å®‰è£…</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> modernx-immer
</code></pre></div><h3 id="åŸºç¡€ä½¿ç”¨"><a href="#åŸºç¡€ä½¿ç”¨" class="header-anchor">#</a> åŸºç¡€ä½¿ç”¨</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'modernx'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> immer <span class="token keyword">from</span> <span class="token string">'modernx-immer'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">immer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">models</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">namespace</span><span class="token operator">:</span> <span class="token string">'todos'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">addTodo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// ä½¿ç”¨ Immer çš„å¯å˜è¯­æ³•</span>
          state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
          state<span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">removeTodo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> index <span class="token operator">=</span> state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">updateTodo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> todo <span class="token operator">=</span> state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> payload<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>todo<span class="token punctuation">,</span> payload<span class="token punctuation">.</span>updates<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="ğŸ“‹-api-å‚è€ƒ"><a href="#ğŸ“‹-api-å‚è€ƒ" class="header-anchor">#</a> ğŸ“‹ API å‚è€ƒ</h2> <h3 id="immer-æ’ä»¶"><a href="#immer-æ’ä»¶" class="header-anchor">#</a> immer æ’ä»¶</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> immer <span class="token keyword">from</span> <span class="token string">'modernx-immer'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">immer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// Immer é…ç½®</span>
      <span class="token literal-property property">enableFreeze</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">enableAutoFreeze</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">immerOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// Immer é€‰é¡¹</span>
        <span class="token function-variable function">onAutoFreeze</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'State frozen:'</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="åœ¨-reducers-ä¸­ä½¿ç”¨"><a href="#åœ¨-reducers-ä¸­ä½¿ç”¨" class="header-anchor">#</a> åœ¨ Reducers ä¸­ä½¿ç”¨</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç®€å•æ›´æ–°</span>
  <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>count <span class="token operator">+=</span> payload<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// æ•°ç»„æ“ä½œ</span>
  <span class="token function-variable function">addItem</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// å¯¹è±¡æ›´æ–°</span>
  <span class="token function-variable function">updateUser</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">u</span> <span class="token operator">=&gt;</span> u<span class="token punctuation">.</span>id <span class="token operator">===</span> payload<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> payload<span class="token punctuation">.</span>updates<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// å¤æ‚æ“ä½œ</span>
  <span class="token function-variable function">updateNestedState</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> userId<span class="token punctuation">,</span> updates <span class="token punctuation">}</span> <span class="token operator">=</span> payload<span class="token punctuation">;</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> state<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">u</span> <span class="token operator">=&gt;</span> u<span class="token punctuation">.</span>id <span class="token operator">===</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>name <span class="token operator">=</span> updates<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
      user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>email <span class="token operator">=</span> updates<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
      user<span class="token punctuation">.</span>preferences<span class="token punctuation">.</span>theme <span class="token operator">=</span> updates<span class="token punctuation">.</span>theme<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ğŸ”§-é«˜çº§ç”¨æ³•"><a href="#ğŸ”§-é«˜çº§ç”¨æ³•" class="header-anchor">#</a> ğŸ”§ é«˜çº§ç”¨æ³•</h2> <h3 id="åµŒå¥—çŠ¶æ€æ›´æ–°"><a href="#åµŒå¥—çŠ¶æ€æ›´æ–°" class="header-anchor">#</a> åµŒå¥—çŠ¶æ€æ›´æ–°</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">updateProfile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ·±å±‚åµŒå¥—æ›´æ–°</span>
    state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>name <span class="token operator">=</span> payload<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>contact<span class="token punctuation">.</span>email <span class="token operator">=</span> payload<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
    state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>contact<span class="token punctuation">.</span>phone <span class="token operator">=</span> payload<span class="token punctuation">.</span>phone<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token function-variable function">addNestedItem</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ·»åŠ åˆ°åµŒå¥—æ•°ç»„</span>
    state<span class="token punctuation">.</span>categories<span class="token punctuation">[</span>payload<span class="token punctuation">.</span>categoryId<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ¡ä»¶æ›´æ–°"><a href="#æ¡ä»¶æ›´æ–°" class="header-anchor">#</a> æ¡ä»¶æ›´æ–°</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">conditionalUpdate</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¡ä»¶æ›´æ–°</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æ¡ä»¶åˆ é™¤</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>force<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ‰¹é‡æ›´æ–°"><a href="#æ‰¹é‡æ›´æ–°" class="header-anchor">#</a> æ‰¹é‡æ›´æ–°</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">batchUpdate</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰¹é‡æ›´æ–°</span>
    payload<span class="token punctuation">.</span>updates<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">update</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> item <span class="token operator">=</span> state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> update<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> update<span class="token punctuation">.</span>changes<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ğŸ¯-ä½¿ç”¨åœºæ™¯"><a href="#ğŸ¯-ä½¿ç”¨åœºæ™¯" class="header-anchor">#</a> ğŸ¯ ä½¿ç”¨åœºæ™¯</h2> <h3 id="_1-å¤æ‚çŠ¶æ€ç»“æ„"><a href="#_1-å¤æ‚çŠ¶æ€ç»“æ„" class="header-anchor">#</a> 1. å¤æ‚çŠ¶æ€ç»“æ„</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> complexModel <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">namespace</span><span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">profile</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">settings</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">notifications</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">friends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ui</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">sidebar</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">250</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">modals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">login</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">settings</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">updateUserProfile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ·±å±‚æ›´æ–°</span>
      state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>name <span class="token operator">=</span> payload<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
      state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>email <span class="token operator">=</span> payload<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
      state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>theme <span class="token operator">=</span> payload<span class="token punctuation">.</span>theme<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">toggleSidebar</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>sidebar<span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>sidebar<span class="token punctuation">.</span>open<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">openModal</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>modals<span class="token punctuation">[</span>payload<span class="token punctuation">]</span><span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">addPost</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>posts<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">addFriend</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-æ•°ç»„å’Œå¯¹è±¡æ“ä½œ"><a href="#_2-æ•°ç»„å’Œå¯¹è±¡æ“ä½œ" class="header-anchor">#</a> 2. æ•°ç»„å’Œå¯¹è±¡æ“ä½œ</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> listModel <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">namespace</span><span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">selectedItems</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">search</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token literal-property property">category</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">sortBy</span><span class="token operator">:</span> <span class="token string">'date'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">addItem</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">removeItem</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> index <span class="token operator">=</span> state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      
      <span class="token comment">// åŒæ—¶ä»é€‰ä¸­é¡¹ä¸­ç§»é™¤</span>
      <span class="token keyword">const</span> selectedIndex <span class="token operator">=</span> state<span class="token punctuation">.</span>selectedItems<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token operator">=&gt;</span> id <span class="token operator">===</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>selectedIndex <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>selectedItems<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>selectedIndex<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">toggleSelection</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> index <span class="token operator">=</span> state<span class="token punctuation">.</span>selectedItems<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token operator">=&gt;</span> id <span class="token operator">===</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>selectedItems<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>selectedItems<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">updateFilters</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>filters<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">clearSelection</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>selectedItems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-æ€§èƒ½ä¼˜åŒ–"><a href="#_3-æ€§èƒ½ä¼˜åŒ–" class="header-anchor">#</a> 3. æ€§èƒ½ä¼˜åŒ–</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> optimizedModel <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">namespace</span><span class="token operator">:</span> <span class="token string">'optimized'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">setData</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä½¿ç”¨ Map è¿›è¡Œé«˜æ•ˆæŸ¥æ‰¾</span>
      state<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">updateData</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> existing <span class="token operator">=</span> state<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>existing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆå¹¶æ›´æ–°</span>
        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>existing<span class="token punctuation">,</span> payload<span class="token punctuation">.</span>updates<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">removeData</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    
    <span class="token function-variable function">clearCache</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="ğŸ”Œ-ä¸å…¶ä»–æ’ä»¶é›†æˆ"><a href="#ğŸ”Œ-ä¸å…¶ä»–æ’ä»¶é›†æˆ" class="header-anchor">#</a> ğŸ”Œ ä¸å…¶ä»–æ’ä»¶é›†æˆ</h2> <h3 id="ä¸-logger-é›†æˆ"><a href="#ä¸-logger-é›†æˆ" class="header-anchor">#</a> ä¸ Logger é›†æˆ</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'modernx'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> immer <span class="token keyword">from</span> <span class="token string">'modernx-immer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> logger <span class="token keyword">from</span> <span class="token string">'modernx-logger'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">immer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// è®°å½•çŠ¶æ€å˜åŒ–</span>
      <span class="token literal-property property">diff</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">models</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">namespace</span><span class="token operator">:</span> <span class="token string">'todos'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">addTodo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          state<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ä¸-loading-é›†æˆ"><a href="#ä¸-loading-é›†æˆ" class="header-anchor">#</a> ä¸ Loading é›†æˆ</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'modernx'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> immer <span class="token keyword">from</span> <span class="token string">'modernx-immer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> loading <span class="token keyword">from</span> <span class="token string">'modernx-loading'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">immer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">loading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">models</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">namespace</span><span class="token operator">:</span> <span class="token string">'api'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">effects</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token operator">*</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> put<span class="token punctuation">,</span> call <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'showLoading'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'fetchData'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>fetchData<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'setData'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'hideLoading'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'fetchData'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">setData</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          state<span class="token punctuation">.</span>data <span class="token operator">=</span> payload<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="ğŸ¨-æœ€ä½³å®è·µ"><a href="#ğŸ¨-æœ€ä½³å®è·µ" class="header-anchor">#</a> ğŸ¨ æœ€ä½³å®è·µ</h2> <h3 id="_1-ä¿æŒ-reducers-çº¯å‡€"><a href="#_1-ä¿æŒ-reducers-çº¯å‡€" class="header-anchor">#</a> 1. ä¿æŒ reducers çº¯å‡€</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// âœ… å¥½çš„åšæ³•</span>
<span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">updateUser</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name <span class="token operator">=</span> payload<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>email <span class="token operator">=</span> payload<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// âŒ é¿å…çš„åšæ³•</span>
<span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">updateUser</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¸è¦åœ¨ reducer ä¸­è¿›è¡Œå¼‚æ­¥æ“ä½œ</span>
    api<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ä¸è¦åœ¨ reducer ä¸­äº§ç”Ÿå‰¯ä½œç”¨</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'User updated:'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name <span class="token operator">=</span> payload<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-ä½¿ç”¨æè¿°æ€§çš„-action-åç§°"><a href="#_2-ä½¿ç”¨æè¿°æ€§çš„-action-åç§°" class="header-anchor">#</a> 2. ä½¿ç”¨æè¿°æ€§çš„ action åç§°</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// âœ… å¥½çš„åšæ³•</span>
<span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">setUserProfile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile <span class="token operator">=</span> payload<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">addTodoItem</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>todos<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// âŒ é¿å…çš„åšæ³•</span>
<span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>user <span class="token operator">=</span> payload<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
    state<span class="token punctuation">.</span>todos <span class="token operator">=</span> payload<span class="token punctuation">.</span>todos<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-åˆç†ç»„ç»‡çŠ¶æ€ç»“æ„"><a href="#_3-åˆç†ç»„ç»‡çŠ¶æ€ç»“æ„" class="header-anchor">#</a> 3. åˆç†ç»„ç»‡çŠ¶æ€ç»“æ„</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// âœ… å¥½çš„åšæ³•</span>
<span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">profile</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">preferences</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filters</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// âŒ é¿å…çš„åšæ³•</span>
<span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">userProfile</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">userPreferences</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">todoItems</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">todoFilters</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isLoading</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ğŸ§ª-æµ‹è¯•"><a href="#ğŸ§ª-æµ‹è¯•" class="header-anchor">#</a> ğŸ§ª æµ‹è¯•</h2> <h3 id="æµ‹è¯•-immer-reducers"><a href="#æµ‹è¯•-immer-reducers" class="header-anchor">#</a> æµ‹è¯• Immer Reducers</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getUserModel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./models/user'</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'userModel with immer'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> model<span class="token punctuation">;</span>
  
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    model <span class="token operator">=</span> <span class="token function">getUserModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should handle nested updates'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">profile</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'john@example.com'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'updateProfile'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Jane'</span><span class="token punctuation">,</span> <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'jane@example.com'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> newState <span class="token operator">=</span> model<span class="token punctuation">.</span>reducers<span class="token punctuation">.</span><span class="token function">updateProfile</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">expect</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Jane'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'jane@example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// éªŒè¯ä¸å¯å˜æ€§</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="æµ‹è¯•å¤æ‚çŠ¶æ€æ“ä½œ"><a href="#æµ‹è¯•å¤æ‚çŠ¶æ€æ“ä½œ" class="header-anchor">#</a> æµ‹è¯•å¤æ‚çŠ¶æ€æ“ä½œ</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'complex state operations'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should handle array operations'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Item 1'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'addItem'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Item 2'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> newState <span class="token operator">=</span> model<span class="token punctuation">.</span>reducers<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">expect</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>items<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveLength</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>newState<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="ğŸš€-ç‰ˆæœ¬å†å²"><a href="#ğŸš€-ç‰ˆæœ¬å†å²" class="header-anchor">#</a> ğŸš€ ç‰ˆæœ¬å†å²</h2> <ul><li><strong>v1.1.1</strong> - ä¿®å¤ç±»å‹å®šä¹‰é—®é¢˜</li> <li><strong>v1.1.0</strong> - æ·»åŠ æ€§èƒ½ä¼˜åŒ–</li> <li><strong>v1.0.0</strong> - åˆå§‹ç‰ˆæœ¬</li></ul> <h2 id="ğŸ“-æ”¯æŒ"><a href="#ğŸ“-æ”¯æŒ" class="header-anchor">#</a> ğŸ“ æ”¯æŒ</h2> <ul><li>ğŸ“– <a href="https://github.com/perlinson/modernx" target="_blank" rel="noopener noreferrer">å®Œæ•´æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>ğŸ› <a href="https://github.com/perlinson/modernx/issues" target="_blank" rel="noopener noreferrer">é—®é¢˜åé¦ˆ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>ğŸ’¬ <a href="https://github.com/perlinson/modernx/discussions" target="_blank" rel="noopener noreferrer">è®¨è®ºåŒº<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <hr> <p><strong>ğŸ”„ è®©çŠ¶æ€æ›´æ–°æ›´åŠ ç®€å•ï¼</strong></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/18/2026, 2:18:10 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/modernx/packages/modernx-logger.html" class="prev">
        modernx-logger
      </a></span> <span class="next"><a href="/modernx/packages/modernx-loading.html">
        modernx-loading
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/modernx/assets/js/app.470600dd.js" defer></script><script src="/modernx/assets/js/2.3d5021cd.js" defer></script><script src="/modernx/assets/js/1.f4cd91dc.js" defer></script><script src="/modernx/assets/js/39.64a03e66.js" defer></script>
  </body>
</html>
