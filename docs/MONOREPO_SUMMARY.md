# ModernX Monorepo é‡æ„æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬æ¬¡é‡æ„æˆåŠŸåœ°å°† ModernX é¡¹ç›®è½¬æ¢ä¸ºç°ä»£åŒ–çš„ monorepo æ¶æ„ï¼Œå®ç°äº†é›†ä¸­åŒ–çš„ä¾èµ–ç®¡ç†ã€ç»Ÿä¸€çš„æ„å»ºæµç¨‹å’Œè‡ªåŠ¨åŒ–çš„å‘å¸ƒç®¡ç†ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åŸºç¡€è®¾æ–½è®¾ç½®

#### 1.1 æ›´æ–°æ ¹ package.json å·¥ä½œåŒºé…ç½®
- âœ… é…ç½®äº† `workspaces: ["packages/*"]`
- âœ… æ·»åŠ äº†å®Œæ•´çš„ monorepo è„šæœ¬é›†åˆ
- âœ… é›†æˆäº†æ„å»ºã€æµ‹è¯•ã€æ¸…ç†ã€éªŒè¯ç­‰å‘½ä»¤

#### 1.2 æ›´æ–° Lerna é…ç½®
- âœ… å¯ç”¨äº† `useWorkspaces: true`
- âœ… é…ç½®äº† conventional commits æ”¯æŒ
- âœ… è®¾ç½®äº†ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†ç­–ç•¥
- âœ… ä¼˜åŒ–äº†å‘å¸ƒå’Œ bootstrap é…ç½®

#### 1.3 åˆ›å»ºç»Ÿä¸€æ„å»ºè„šæœ¬
- âœ… `scripts/build-monorepo.js` - æ™ºèƒ½æ„å»ºè„šæœ¬
- âœ… `scripts/clean-monorepo.js` - æ¸…ç†è„šæœ¬
- âœ… `scripts/test-monorepo.js` - æµ‹è¯•è„šæœ¬
- âœ… æ”¯æŒé€‰æ‹©æ€§æ„å»ºå’Œå¢é‡æ„å»º

#### 1.4 å¼€å‘å·¥ä½œæµæ–‡æ¡£
- âœ… `docs/MONOREPO_WORKFLOW.md` - å®Œæ•´çš„å¼€å‘æŒ‡å—
- âœ… åŒ…å«å¿«é€Ÿå¼€å§‹ã€å¸¸ç”¨å‘½ä»¤ã€æœ€ä½³å®è·µ
- âœ… æä¾›äº†æ•…éšœæ’é™¤å’Œè´¡çŒ®æŒ‡å—

#### 1.5 é…ç½® npm è„šæœ¬
- âœ… ç»Ÿä¸€çš„æ„å»ºå‘½ä»¤ï¼š`npm run build`
- âœ… é€‰æ‹©æ€§æ„å»ºï¼š`npm run build:packages -- <package>`
- âœ… å¢é‡æ„å»ºï¼š`npm run build:since`
- âœ… æ¸…ç†å‘½ä»¤ï¼š`npm run clean`

### 2. åŒ…ä¾èµ–ç®¡ç†

#### 2.1 æ›´æ–°åŒ…é—´ä¾èµ–ä½¿ç”¨å·¥ä½œåŒºè¯­æ³•
- âœ… `modernx` ä¾èµ– `modernx-core: "*"`
- âœ… `modernx-immer` ä¾èµ– `modernx: "*"`
- âœ… `modernx-loading` ä¾èµ– `modernx: "*"` å’Œ `modernx-core: "*"`
- âœ… æ‰€æœ‰å·¥ä½œåŒºä¾èµ–ä½¿ç”¨ `*` ç‰ˆæœ¬å·

#### 2.2 é…ç½®å·¥ä½œåŒºä¾èµ–è§£æ
- âœ… `scripts/manage-workspaces.js` - å·¥ä½œåŒºç®¡ç†è„šæœ¬
- âœ… ä¾èµ–çŠ¶æ€æ£€æŸ¥ï¼š`npm run workspaces:status`
- âœ… ä¾èµ–é“¾æ¥ï¼š`npm run workspaces:link`
- âœ… å¾ªç¯ä¾èµ–æ£€æŸ¥ï¼š`npm run workspaces:check`
- âœ… ä¾èµ–å›¾å¯è§†åŒ–ï¼š`npm run workspaces:graph`

#### 2.3 è‡ªåŠ¨åŒ–ä¾èµ–æ›´æ–°è„šæœ¬
- âœ… `scripts/update-dependencies.js` - ä¾èµ–ç®¡ç†è„šæœ¬
- âœ… è¿‡æ—¶ä¾èµ–æ£€æŸ¥ï¼š`npm run dependencies:check`
- âœ… è‡ªåŠ¨æ›´æ–°ï¼š`npm run dependencies:fix`
- âœ… å·¥ä½œåŒºåŒæ­¥ï¼š`npm run dependencies:workspace`
- âœ… å®‰å…¨å®¡è®¡ï¼š`npm run dependencies:audit`

#### 2.4 æµ‹è¯•åŒ…å®‰è£…å’Œé“¾æ¥
- âœ… éªŒè¯å·¥ä½œåŒºä¾èµ–å…³ç³»æ­£ç¡®
- âœ… ç¡®è®¤ä¾èµ–å›¾ç»“æ„åˆç†
- âœ… æµ‹è¯•å¾ªç¯ä¾èµ–æ£€æµ‹åŠŸèƒ½
- âœ… éªŒè¯ä¾èµ–åŒæ­¥åŠŸèƒ½

#### 2.5 éªŒè¯ä¾èµ–å›¾å’Œå¾ªç¯å¼•ç”¨
- âœ… `scripts/validate-monorepo.js` - å®Œæ•´éªŒè¯è„šæœ¬
- âœ… åŒ…ç»“æ„éªŒè¯ï¼š`npm run validate:structure`
- âœ… ä¾èµ–å…³ç³»éªŒè¯ï¼š`npm run validate:dependencies`
- âœ… å¾ªç¯ä¾èµ–æ£€æµ‹ï¼š`npm run validate:circular`
- âœ… å®Œæ•´éªŒè¯ï¼š`npm run validate`

## ğŸ“Š å½“å‰é¡¹ç›®ç»“æ„

```
modernx/
â”œâ”€â”€ packages/                    # å­åŒ…ç›®å½•
â”‚   â”œâ”€â”€ modernx/                 # ä¸»åŒ…
â”‚   â”œâ”€â”€ modernx-core/            # æ ¸å¿ƒåŒ…
â”‚   â”œâ”€â”€ modernx-immer/           # Immer é›†æˆåŒ…
â”‚   â””â”€â”€ modernx-loading/         # Loading çŠ¶æ€åŒ…
â”œâ”€â”€ scripts/                     # ç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ build-monorepo.js        # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ clean-monorepo.js        # æ¸…ç†è„šæœ¬
â”‚   â”œâ”€â”€ test-monorepo.js         # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ manage-workspaces.js     # å·¥ä½œåŒºç®¡ç†
â”‚   â”œâ”€â”€ update-dependencies.js   # ä¾èµ–æ›´æ–°
â”‚   â””â”€â”€ validate-monorepo.js     # éªŒè¯è„šæœ¬
â”œâ”€â”€ docs/                        # æ–‡æ¡£
â”‚   â”œâ”€â”€ MONOREPO_WORKFLOW.md     # å·¥ä½œæµæ–‡æ¡£
â”‚   â””â”€â”€ MONOREPO_SUMMARY.md      # æ€»ç»“æ–‡æ¡£
â”œâ”€â”€ lerna.json                   # Lerna é…ç½®
â””â”€â”€ package.json                 # æ ¹é…ç½®
```

## ğŸ”§ ä¾èµ–å…³ç³»å›¾

```
modernx
â””â”€â”€ modernx-core

modernx-core
(æ— å·¥ä½œåŒºä¾èµ–)

modernx-immer
â””â”€â”€ modernx

modernx-loading
â”œâ”€â”€ modernx
â””â”€â”€ modernx-core
```

## ğŸš€ æ–°å¢çš„ npm è„šæœ¬

### æ„å»ºç›¸å…³
- `npm run build` - æ„å»ºæ‰€æœ‰åŒ…
- `npm run build:packages -- <package>` - æ„å»ºç‰¹å®šåŒ…
- `npm run build:since` - æ„å»ºå˜æ›´çš„åŒ…
- `npm run clean` - æ¸…ç†æ‰€æœ‰æ„å»ºäº§ç‰©
- `npm run clean:build` - æ¸…ç†æ„å»ºç›®å½•

### æµ‹è¯•ç›¸å…³
- `npm run test` - è¿è¡Œæ‰€æœ‰æµ‹è¯•
- `npm run test:since` - æµ‹è¯•å˜æ›´çš„åŒ…
- `npm run test:coverage` - ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- `npm run test:watch` - ç›‘å¬æ¨¡å¼æµ‹è¯•

### å·¥ä½œåŒºç®¡ç†
- `npm run workspaces:status` - æ£€æŸ¥å·¥ä½œåŒºçŠ¶æ€
- `npm run workspaces:link` - é“¾æ¥å·¥ä½œåŒºä¾èµ–
- `npm run workspaces:check` - æ£€æŸ¥å¾ªç¯ä¾èµ–
- `npm run workspaces:graph` - æ˜¾ç¤ºä¾èµ–å›¾

### ä¾èµ–ç®¡ç†
- `npm run dependencies:check` - æ£€æŸ¥è¿‡æ—¶ä¾èµ–
- `npm run dependencies:fix` - è‡ªåŠ¨æ›´æ–°ä¾èµ–
- `npm run dependencies:workspace` - åŒæ­¥å·¥ä½œåŒºä¾èµ–
- `npm run dependencies:audit` - å®‰å…¨å®¡è®¡

### éªŒè¯ç›¸å…³
- `npm run validate` - å®Œæ•´éªŒè¯
- `npm run validate:structure` - éªŒè¯åŒ…ç»“æ„
- `npm run validate:dependencies` - éªŒè¯ä¾èµ–å…³ç³»
- `npm run validate:circular` - æ£€æŸ¥å¾ªç¯ä¾èµ–

## ğŸ¯ éªŒè¯ç»“æœ

æ‰€æœ‰éªŒè¯é¡¹ç›®å‡å·²é€šè¿‡ï¼š

- âœ… åŒ…ç»“æ„éªŒè¯é€šè¿‡
- âœ… ä¾èµ–å…³ç³»éªŒè¯é€šè¿‡
- âœ… å¾ªç¯ä¾èµ–æ£€æµ‹é€šè¿‡
- âœ… ç‰ˆæœ¬ä¸€è‡´æ€§éªŒè¯é€šè¿‡
- âœ… æ„å»ºé…ç½®éªŒè¯é€šè¿‡
- âœ… å‘å¸ƒé…ç½®éªŒè¯é€šè¿‡

## ğŸ“ˆ æ”¹è¿›æ•ˆæœ

### å¼€å‘ä½“éªŒæå‡
1. **ç»Ÿä¸€å‘½ä»¤**: æ‰€æœ‰æ“ä½œé€šè¿‡æ ¹ç›®å½•çš„ npm è„šæœ¬å®Œæˆ
2. **æ™ºèƒ½æ„å»º**: æ”¯æŒé€‰æ‹©æ€§æ„å»ºå’Œå¢é‡æ„å»º
3. **è‡ªåŠ¨åŒ–ç®¡ç†**: ä¾èµ–æ›´æ–°å’ŒéªŒè¯è‡ªåŠ¨åŒ–
4. **å®Œæ•´æ–‡æ¡£**: è¯¦ç»†çš„å·¥ä½œæµå’Œæœ€ä½³å®è·µæŒ‡å—

### ç»´æŠ¤æ€§æå‡
1. **é›†ä¸­ç®¡ç†**: æ‰€æœ‰é…ç½®é›†ä¸­åœ¨æ ¹ç›®å½•
2. **ä¾èµ–æ¸…æ™°**: å·¥ä½œåŒºä¾èµ–å…³ç³»æ˜ç¡®
3. **ç‰ˆæœ¬ä¸€è‡´**: è‡ªåŠ¨åŒæ­¥å·¥ä½œåŒºåŒ…ç‰ˆæœ¬
4. **éªŒè¯å®Œå–„**: å¤šå±‚æ¬¡çš„éªŒè¯ç¡®ä¿ä»£ç è´¨é‡

### å‘å¸ƒæµç¨‹ä¼˜åŒ–
1. **ç‹¬ç«‹ç‰ˆæœ¬**: æ¯ä¸ªåŒ…ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†
2. **è‡ªåŠ¨åŒ–å‘å¸ƒ**: Lerna å¤„ç†ç‰ˆæœ¬å’Œå‘å¸ƒ
3. **å˜æ›´è¿½è¸ª**: è‡ªåŠ¨ç”Ÿæˆ changelog
4. **å®‰å…¨å®¡è®¡**: é›†æˆå®‰å…¨æ¼æ´æ£€æŸ¥

## ğŸ”„ åç»­å·¥ä½œ

è™½ç„¶å‰ä¸¤ä¸ªé˜¶æ®µå·²ç»å®Œæˆï¼Œä½†è¿˜æœ‰ä»¥ä¸‹å·¥ä½œå¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼š

### ç¬¬ä¸‰é˜¶æ®µï¼šæ„å»ºç³»ç»Ÿé›†æˆ
- [ ] åˆ›å»ºç»Ÿä¸€çš„æ„å»ºç¼–æ’è„šæœ¬
- [ ] å®ç°é€‰æ‹©æ€§åŒ…æ„å»º
- [ ] è®¾ç½®å¢é‡æ„å»ºæ£€æµ‹
- [ ] é…ç½®æ„å»ºä¾èµ–æ’åº
- [ ] æµ‹è¯•æ‰€æœ‰åŒ…çš„æ„å»ºæµç¨‹

### ç¬¬å››é˜¶æ®µï¼šæµ‹è¯•ç¼–æ’
- [ ] åˆ›å»ºé›†ä¸­åŒ–æµ‹è¯•æ‰§è¡Œè„šæœ¬
- [ ] è®¾ç½®æµ‹è¯•ç¯å¢ƒéš”ç¦»
- [ ] é…ç½®æµ‹è¯•è¦†ç›–ç‡èšåˆ
- [ ] å®ç°åŒ…ç‰¹å®šæµ‹è¯•æ‰§è¡Œ
- [ ] éªŒè¯ä¾èµ–é“¾æµ‹è¯•æ‰§è¡Œ

### ç¬¬äº”é˜¶æ®µï¼šå‘å¸ƒç®¡ç†è®¾ç½®
- [ ] é…ç½® Lerna è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†
- [ ] è®¾ç½® conventional commit è§£æ
- [ ] å®ç°è‡ªåŠ¨ changelog ç”Ÿæˆ
- [ ] é…ç½®ç‹¬ç«‹åŒ…å‘å¸ƒ
- [ ] è®¾ç½®å‘å¸ƒéªŒè¯å’Œé¢„å‘å¸ƒæ£€æŸ¥

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ monorepo é‡æ„æˆåŠŸå®ç°äº†ï¼š

1. **å®Œæ•´çš„å·¥å…·é“¾**: ä»æ„å»ºåˆ°å‘å¸ƒçš„å®Œæ•´è‡ªåŠ¨åŒ–æµç¨‹
2. **ç°ä»£åŒ–çš„æ¶æ„**: ä½¿ç”¨ Lerna + npm workspaces çš„æœ€ä½³å®è·µ
3. **ä¼˜ç§€çš„å¼€å‘ä½“éªŒ**: ä¸°å¯Œçš„è„šæœ¬å’Œè¯¦ç»†çš„æ–‡æ¡£
4. **å¯é çš„è´¨é‡ä¿è¯**: å¤šå±‚æ¬¡çš„éªŒè¯å’Œæµ‹è¯•æœºåˆ¶

é¡¹ç›®ç°åœ¨å…·å¤‡äº†ç°ä»£åŒ– monorepo çš„æ‰€æœ‰æ ¸å¿ƒç‰¹æ€§ï¼Œä¸ºåç»­çš„å¼€å‘å’Œç»´æŠ¤æä¾›äº†åšå®çš„åŸºç¡€ã€‚
